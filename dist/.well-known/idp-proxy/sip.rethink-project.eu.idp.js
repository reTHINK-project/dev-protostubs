System.register([],function(e){return{execute:function(){e(function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=3)}({3:function(e,t,o){"use strict";o.r(t);let n="rethink-project.eu";t.default=class{constructor(){}_start(e,t,o){this.runtimeProtoStubURL=e,this.messageBus=t,this.config=o,this.messageBus.addListener("*",e=>{e.to===`domain-idp://${n}`&&this.requestToIdp(e)}),this._sendStatus("created")}_sendStatus(e,t){console.log("[Slack Idp Proxy status changed] to ",e),this._state=e;let o={type:"update",from:this.runtimeProtoStubURL,to:this.runtimeProtoStubURL+"/status",body:{value:e}};t&&(o.body.desc=t),this.messageBus.postMessage(o)}requestToIdp(e){let t=e.body.params;switch(e.body.method){case"generateAssertion":this.generateAssertion(t.contents,t.origin,t.usernameHint).then(t=>this.replyMessage(e,t)).catch(t=>this.replyMessage(e,t));break;case"validateAssertion":this.replyMessage(e,{identity:"identity@idp.com",contents:"content"})}}generateAssertion(e,t,o){return console.log("contents->",e),console.log("origin->",t),console.log("hint->",o),new Promise((e,t)=>{if(o){let r=this._urlParser(o,"access_token"),s=Math.floor(Date.now()/1e3)+this._urlParser(o,"expires_in");fetch(`https://www.googleapis.com/oauth2/v1/userinfo?access_token=${r}`).then(e=>e.json()).then(t=>{let o={picture:t.picture,email:t.email,family_name:t.family_name,given_name:t.given_name},i=btoa(JSON.stringify({tokenID:r,email:t.email,id:t.id})),a={info:{expires:s},assertion:i,idp:{domain:n,protocol:"OAuth 2.0"},infoToken:o,interworking:{access_token:r,domain:n}};console.log("RESOLVING THIS OBJECT",a),e(a)}).catch(t)}else{let e=`https://accounts.google.com/o/oauth2/v2/auth?scope=email%20profile&state=%2Fprofile&redirect_uri=${location.protocol}//${location.hostname}&response_type=token&client_id=808329566012-tqr8qoh111942gd2kg007t0s8f277roi.apps.googleusercontent.com`;console.log("first url ",e,"done"),t({name:"IdPLoginError",loginUrl:e})}})}_urlParser(e,t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");let o=new RegExp("[\\#&?]"+t+"=([^&#]*)").exec(e);return null===o?"":o[1]}replyMessage(e,t){let o={id:e.id,type:"response",to:e.from,from:e.to,body:{code:200,value:t}};this.messageBus.postMessage(o)}}}}))}}});