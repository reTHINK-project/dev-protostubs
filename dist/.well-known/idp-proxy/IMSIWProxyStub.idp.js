!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("activate",[],t):"object"==typeof exports?exports.activate=t():e.activate=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,o){"use strict";function n(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o){return{name:"IMSIWProxyStub",instance:new i(e,t,o)}};var r="rethink-project.eu",i=function(){function e(t,o,n){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.runtimeProtoStubURL=t,this.messageBus=o,this.config=n,this.messageBus.addListener("*",function(e){e.to==="domain-idp://".concat(r)&&i.requestToIdp(e)}),this._sendStatus("created")}return function(e,t,o){t&&n(e.prototype,t),o&&n(e,o)}(e,[{key:"_sendStatus",value:function(e,t){console.log("[Slack Idp Proxy status changed] to ",e),this._state=e;var o={type:"update",from:this.runtimeProtoStubURL,to:this.runtimeProtoStubURL+"/status",body:{value:e}};t&&(o.body.desc=t),this.messageBus.postMessage(o)}},{key:"requestToIdp",value:function(e){var t=this,o=e.body.params;switch(e.body.method){case"generateAssertion":this.generateAssertion(o.contents,o.origin,o.usernameHint).then(function(o){return t.replyMessage(e,o)}).catch(function(o){return t.replyMessage(e,o)});break;case"validateAssertion":this.replyMessage(e,{identity:"identity@idp.com",contents:"content"})}}},{key:"generateAssertion",value:function(e,t,o){var n=this;return console.log("contents->",e),console.log("origin->",t),console.log("hint->",o),new Promise(function(e,t){if(o){var i=n._urlParser(o,"access_token"),s=Math.floor(Date.now()/1e3)+n._urlParser(o,"expires_in");fetch("https://www.googleapis.com/oauth2/v1/userinfo?access_token=".concat(i)).then(function(e){return e.json()}).then(function(t){var o={picture:t.picture,email:t.email,family_name:t.family_name,given_name:t.given_name},n=btoa(JSON.stringify({tokenID:i,email:t.email,id:t.id})),a={info:{expires:s},assertion:n,idp:{domain:r,protocol:"OAuth 2.0"},infoToken:o,interworking:{access_token:i,domain:r}};console.log("RESOLVING THIS OBJECT",a),e(a)}).catch(t)}else{var a="https://accounts.google.com/o/oauth2/v2/auth?scope=email%20profile&state=%2Fprofile&redirect_uri=".concat(location.protocol,"//").concat(location.hostname,"&response_type=token&client_id=808329566012-tqr8qoh111942gd2kg007t0s8f277roi.apps.googleusercontent.com");console.log("first url ",a,"done"),t({name:"IdPLoginError",loginUrl:a})}})}},{key:"_urlParser",value:function(e,t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var o=new RegExp("[\\#&?]"+t+"=([^&#]*)").exec(e);return null===o?"":o[1]}},{key:"replyMessage",value:function(e,t){var o={id:e.id,type:"response",to:e.from,from:e.to,body:{code:200,value:t}};this.messageBus.postMessage(o)}}]),e}()}]).default});