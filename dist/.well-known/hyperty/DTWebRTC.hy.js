System.register([],function(e){return{execute:function(){e(function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=27)}({27:function(e,t,n){"use strict";n.r(t);var r=n(3);n(28);t.default=class extends r.a{constructor(){super()}set name(e){this._name=e}get name(){return this._name}get runtimeHypertyURL(){return this.myUrl}_start(e,t,n,r){if(!e)throw new Error("The hypertyURL is a needed parameter");if(!t)throw new Error("The MiniBus is a needed parameter");if(!n)throw new Error("The configuration is a needed parameter");this._domain=r.divideURL(e).domain,this._objectDescURL="hyperty-catalogue://catalogue."+this._domain+"/.well-known/dataschema/Connection",this._syncher=r.createSyncher(e,t,n),this.discovery=r.createDiscovery(e,n.runtimeURL,t),console.log("[DTWebRTC] [constructor] >>>>> Discovery object is:",this.discovery);let i=r.createIdentityManager(e,n.runtimeURL,t);this.search=r.createSearch(this.discovery,i),this.objObserver,this.objReporter,this.callerIdentity,this.constraints={audio:!0,video:!0},this.receivingConstraints={offerToReceiveAudio:1,offerToReceiveVideo:1},this.sender=null,this.myUrl=e,this.partner=null,this.pc=null,this.mediaStream=null,this.iceconfig=n,this._syncher.onNotification(e=>{this._onNotification(e)})}_onNotification(e){switch(null==this.sender&&(this.sender=!1),console.info("[DTWebRTC]: Event Received: ",e),e.type){case"create":this.createPC(),this.callerIdentity=e.identity,console.info("[DTWebRTC]: [_onNotification] sending event.ack() ");let t=e.ack();console.info("[DTWebRTC]: [_onNotification] event.ack() result is:",t),setTimeout(()=>{let t={schema:this._objectDescURL,resource:e.url};this._syncher.subscribe(t).then(t=>{console.info("[DTWebRTC]: [_onNotification] objObserver ",t),this.objObserver=t,this.sender||(this.partner=e.from,console.log("got invite"),this.trigger("incomingcall",this.callerIdentity)),this.handleObserverObject(t)}).catch(e=>{console.error(e)})},750);break;case"delete":this.cleanupPC(),this.trigger("disconnected")}}connect(e){return this.partner=e,null==this.sender&&(this.sender=!0),new Promise((t,n)=>{let r={name:"Connection",status:"",owner:this.myUrl,connectionDescription:{},iceCandidates:[]};this._syncher.create(this._objectDescURL,[e],r,!0,!1,"call",{},{resources:["audio","video"]}).then(e=>{console.info("1. Return Created WebRTC Object Reporter",e),this.objReporter=e,this.sender&&this.invite().then(e=>{this.objReporter.data.connectionDescription=e}),e.onSubscription(function(n){console.info("-------- Receiver received subscription request --------- \n"),n.accept(),t(e)})}).catch(function(e){console.error(e),n(e)})})}setMediaOptions(e){this.constraints=e}invite(){return this.createPC(),new Promise((e,t)=>{console.log(">>>Constraints",this.constraints),navigator.mediaDevices.getUserMedia(this.constraints).then(n=>{console.log("[DTWebRTC]: localviodeo"),this.trigger("localvideo",n),this.mediaStream=n,this.pc.addStream(n),this.pc.createOffer().then(n=>{this.pc.setLocalDescription(new RTCSessionDescription(n),()=>{e(n)},function(){t()})}).catch(e=>{t("Create Offer failed: ",e)})})})}acceptCall(){this.objObserver.data&&this.objObserver.data.connectionDescription?(console.log("[DTWebRTC]: >>>Constraints",this.constraints),navigator.mediaDevices.getUserMedia(this.constraints).then(e=>{this.trigger("localvideo",e),this.mediaStream=e,this.pc.addStream(e),this.connect(this.partner).then(e=>{console.log("[DTWebRTC]: objReporter created successfully: ",e),this.objReporter=e,this.pc.createAnswer().then(e=>{this.objReporter.data.connectionDescription=e,this.pc.setLocalDescription(new RTCSessionDescription(e),()=>{console.log("[DTWebRTC]: localDescription (answer) successfully set: ",e)},e=>{console.log("Error in setLocalDescription: "+e)})})})})):console.log("[DTWebRTC]: offer was't set in the invitation - data: ",data)}setIceServer(e,t){this.iceconfig.ice=t?e:e.concat(this.iceconfig.ice)}createPC(){this.pc||(this.pc=new RTCPeerConnection(this.iceconfig),console.log("[DTWebRTC]: created PeerConnection",this.pc),this.pc.onaddstream=e=>{console.log("[DTWebRTC]: >>>onaddstream",this.pc),this.trigger("remotevideo",e.stream)},this.pc.onicecandidate=e=>{if(console.log("[DTWebRTC]: icecandidateevent occured: ",e),!e.candidate)return;let t={type:"candidate",candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex},n=this.objReporter.data,r=JSON.parse(JSON.stringify(n.iceCandidates));r.push(t),this.objReporter.data.iceCandidates=r},this.pc.onRemoteStreamRemoved=e=>{console.log(">>>stream removed from remote",e)})}handleObserverObject(e){let t=e.data;console.info("[DTWebRTC]: handleObserverObject Peer Data:",t),t.hasOwnProperty("connectionDescription")&&this.processPeerInformation(t.connectionDescription),t.hasOwnProperty("iceCandidates")&&t.iceCandidates.forEach(e=>{console.log("[DTWebRTC]: handleObserverObject for ice",e),this.processPeerInformation(e)}),e.onChange("*",e=>{console.debug("[DTWebRTC]: Observer on change message: ",e),e.data[0]?(console.log(">>event.data[0]",e.data[0]),this.processPeerInformation(e.data[0])):(console.log("[DTWebRTC]: >>event",e),this.processPeerInformation(e.data))})}processPeerInformation(e){console.info("[DTWebRTC]: processPeerInformation: ",JSON.stringify(e)),this.pc?("offer"!==e.type&&"answer"!==e.type||(console.info("[DTWebRTC]: Process Connection Description: ",e),this.pc.setRemoteDescription(new RTCSessionDescription(e)).then(()=>{console.log("[DTWebRTC]: remote success")},e=>{console.log("[DTWebRTC]: setRemoteDescription error: ",e)})),e.candidate&&(console.info("Process Ice Candidate: ",e),this.pc.addIceCandidate(new RTCIceCandidate(e)))):console.info("[DTWebRTC]: processPeerInformation: no PeerConnection existing --\x3e maybe in disconnecting process. --\x3e ignoring this update")}cleanupPC(){this.sender=null,this.mediaStream&&this.pc&&this.mediaStream.getTracks().forEach(e=>{e.stop()}),this.pc&&this.pc.close(),this.pc=null}disconnect(){return console.log("[DTWebRTC]>>>lets disconnect",this),new Promise((e,t)=>{try{this.objReporter&&this.objReporter.delete(),this.objObserver&&this.objObserver.delete(),this.cleanupPC(),this.trigger("disconnected"),e()}catch(e){t(e)}})}switchLocalAudio(e){console.log("[DTWebRTC] --\x3e setting local audio to: "+e);try{this.mediaStream.getAudioTracks()[0].enabled=e}catch(e){console.err("error while (un)muting local audio state!")}}switchLocalVideo(e){console.log("[DTWebRTC] --\x3e setting local video to: "+e);try{this.mediaStream.getVideoTracks()[0].enabled=e}catch(e){console.err("error while (un)muting local video state!")}}}},28:function(e,t,n){"use strict";var r=null,i=null,o=null,a=null,s=null,c=null,d={log:function(){},extractVersion:function(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}};if("object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return"mozSrcObject"in this?this.mozSrcObject:this._srcObject},set:function(e){"mozSrcObject"in this?this.mozSrcObject=e:(this._srcObject=e,this.src=URL.createObjectURL(e))}}),r=window.navigator&&window.navigator.getUserMedia),i=function(e,t){e.srcObject=t},o=function(e,t){e.srcObject=t.srcObject},"undefined"!=typeof window&&window.navigator)if(navigator.mozGetUserMedia){if(d.log("This appears to be Firefox"),a="firefox",s=d.extractVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1),c=31,window.RTCPeerConnection||(window.RTCPeerConnection=function(e,t){if(s<38&&e&&e.iceServers){for(var n=[],r=0;r<e.iceServers.length;r++){var i=e.iceServers[r];if(i.hasOwnProperty("urls"))for(var o=0;o<i.urls.length;o++){var a={url:i.urls[o]};0===i.urls[o].indexOf("turn")&&(a.username=i.username,a.credential=i.credential),n.push(a)}else n.push(e.iceServers[r])}e.iceServers=n}return new mozRTCPeerConnection(e,t)},window.RTCPeerConnection.prototype=mozRTCPeerConnection.prototype,mozRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return arguments.length?mozRTCPeerConnection.generateCertificate.apply(null,arguments):mozRTCPeerConnection.generateCertificate}}),window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate),r=function(e,t,n){var r=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r=e[n]="object"==typeof e[n]?e[n]:{ideal:e[n]};if(void 0===r.min&&void 0===r.max&&void 0===r.exact||t.push(n),void 0!==r.exact&&("number"==typeof r.exact?r.min=r.max=r.exact:e[n]=r.exact,delete r.exact),void 0!==r.ideal){e.advanced=e.advanced||[];var i={};"number"==typeof r.ideal?i[n]={min:r.ideal,max:r.ideal}:i[n]=r.ideal,e.advanced.push(i),delete r.ideal,Object.keys(r).length||delete e[n]}}}),t.length&&(e.require=t),e};return s<38&&(d.log("spec: "+JSON.stringify(e)),e.audio&&(e.audio=r(e.audio)),e.video&&(e.video=r(e.video)),d.log("ff37: "+JSON.stringify(e))),navigator.mozGetUserMedia(e,t,n)},navigator.getUserMedia=r,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:m,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},s<41){var p=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return p().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}}else if(navigator.webkitGetUserMedia&&window.webkitRTCPeerConnection){d.log("This appears to be Chrome"),a="chrome",s=d.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2),c=38,window.RTCPeerConnection=function(e,t){e&&e.iceTransportPolicy&&(e.iceTransports=e.iceTransportPolicy);var n=new webkitRTCPeerConnection(e,t),r=n.getStats.bind(n);return n.getStats=function(e,t,n){var i=this,o=arguments;if(arguments.length>0&&"function"==typeof e)return r(e,t);var a=function(e){var t={};return e.result().forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),t[n.id]=n}),t};if(arguments.length>=2){var s=function(e){o[1](a(e))};return r.apply(this,[s,arguments[0]])}return new Promise(function(t,n){1===o.length&&null===e?r.apply(i,[function(e){t.apply(null,[a(e)])},n]):r.apply(i,[t,n])})},n},window.RTCPeerConnection.prototype=webkitRTCPeerConnection.prototype,webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return arguments.length?webkitRTCPeerConnection.generateCertificate.apply(null,arguments):webkitRTCPeerConnection.generateCertificate}}),["createOffer","createAnswer"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var n=1===arguments.length?arguments[0]:void 0;return new Promise(function(r,i){t.apply(e,[r,i,n])})}return t.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=arguments,n=this;return new Promise(function(r,i){t.apply(n,[e[0],function(){r(),e.length>=2&&e[1].apply(null,[])},function(t){i(t),e.length>=3&&e[2].apply(null,[t])}])})}});var l=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];var o={};"number"==typeof r.ideal?(o[i("min",n)]=r.ideal,t.optional.push(o),(o={})[i("max",n)]=r.ideal,t.optional.push(o)):(o[i("",n)]=r.ideal,t.optional.push(o))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach(function(e){void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t};if(r=function(e,t,n){return e.audio&&(e.audio=l(e.audio)),e.video&&(e.video=l(e.video)),d.log("chrome: "+JSON.stringify(e)),navigator.webkitGetUserMedia(e,t,n)},navigator.getUserMedia=r,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:m,enumerateDevices:function(){return new Promise(function(e){var t={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(n){e(n.map(function(e){return{label:e.label,kind:t[e.kind],deviceId:e.id,groupId:""}}))})})}}),navigator.mediaDevices.getUserMedia){var u=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(e){return d.log("spec:   "+JSON.stringify(e)),e.audio=l(e.audio),e.video=l(e.video),d.log("chrome: "+JSON.stringify(e)),u(e)}}else navigator.mediaDevices.getUserMedia=function(e){return m(e)};void 0===navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){d.log("Dummy mediaDevices.addEventListener called.")}),void 0===navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){d.log("Dummy mediaDevices.removeEventListener called.")}),i=function(e,t){s>=43?e.srcObject=t:void 0!==e.src?e.src=URL.createObjectURL(t):d.log("Error attaching stream to element.")},o=function(e,t){s>=43?e.srcObject=t.srcObject:e.src=t.src}}else if(navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)){if(d.log("This appears to be Edge"),a="edge",s=d.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2),c=10547,window.RTCIceGatherer){var f=function(){return Math.random().toString(36).substr(2,10)},h=f(),v={splitLines:function(e){return e.trim().split("\n").map(function(e){return e.trim()})},splitSections:function(e){return e.split("\r\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},matchPrefix:function(e,t){return v.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},parseCandidate:function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1]}return n},writeCandidate:function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),"candidate:"+t.join(" ")},parseRtpMap:function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.numChannels=3===t.length?parseInt(t[2],10):1,n},writeRtpMap:function(e){var t=e.payloadType;return void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==e.numChannels?"/"+e.numChannels:"")+"\r\n"},parseFmtp:function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)n[(t=r[i].trim().split("="))[0].trim()]=t[1];return n},writeFtmp:function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&e.parameters.length){var r=[];Object.keys(e.parameters).forEach(function(t){r.push(t+"="+e.parameters[t])}),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},parseRtcpFb:function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},writeRtcpFb:function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+" "+e.parameter+"\r\n"}),t},parseSsrcMedia:function(e){var t=e.indexOf(" "),n={ssrc:e.substr(7,t-7)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},getDtlsParameters:function(e,t){var n=v.splitLines(e),r=(n=n.concat(v.splitLines(t))).filter(function(e){return 0===e.indexOf("a=fingerprint:")})[0].substr(14);return{role:"auto",fingerprints:[{algorithm:r.split(" ")[0],value:r.split(" ")[1]}]}},writeDtlsParameters:function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},getIceParameters:function(e,t){var n=v.splitLines(e);return{usernameFragment:(n=n.concat(v.splitLines(t))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:n.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},writeIceParameters:function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},parseRtpParameters:function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=v.splitLines(e)[0].split(" "),r=3;r<n.length;r++){var i=n[r],o=v.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(o){var a=v.parseRtpMap(o),s=v.matchPrefix(e,"a=fmtp:"+i+" ");a.parameters=s.length?v.parseFmtp(s[0]):{},a.rtcpFeedback=v.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(v.parseRtcpFb),t.codecs.push(a)}}return t},writeRtpDescription:function(e,t){var n="";return n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){n+=v.writeRtpMap(e),n+=v.writeFtmp(e),n+=v.writeRtcpFb(e)}),n+="a=rtcp-mux\r\n"},writeSessionBoilerplate:function(){return"v=0\r\no=thisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},writeMediaSection:function(e,t,n,r){var i=v.writeRtpDescription(e.kind,t);if(i+=v.writeIceParameters(e.iceGatherer.getLocalParameters()),i+=v.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),i+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?i+="a=sendrecv\r\n":e.rtpSender?i+="a=sendonly\r\n":e.rtpReceiver?i+="a=recvonly\r\n":i+="a=inactive\r\n",e.rtpSender){var o="msid:"+r.id+" "+e.rtpSender.track.id+"\r\n";i+="a="+o,i+="a=ssrc:"+e.sendSsrc+" "+o}return i+="a=ssrc:"+e.sendSsrc+" cname:"+h+"\r\n"},getDirection:function(e,t){for(var n=v.splitLines(e),r=0;r<n.length;r++)switch(n[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[r].substr(2)}return t?v.getDirection(t):"sendrecv"}};window.RTCIceCandidate||(window.RTCIceCandidate=function(e){return e}),window.RTCSessionDescription||(window.RTCSessionDescription=function(e){return e}),window.RTCPeerConnection=function(e){var t=this;if(this.onicecandidate=null,this.onaddstream=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.localStreams=[],this.remoteStreams=[],this.getLocalStreams=function(){return t.localStreams},this.getRemoteStreams=function(){return t.remoteStreams},this.localDescription=new C({type:"",sdp:""}),this.remoteDescription=new C({type:"",sdp:""}),this.signalingState="stable",this.iceConnectionState="new",this.iceOptions={gatherPolicy:"all",iceServers:[]},e&&e.iceTransportPolicy)switch(e.iceTransportPolicy){case"all":case"relay":this.iceOptions.gatherPolicy=e.iceTransportPolicy;break;case"none":throw new TypeError('iceTransportPolicy "none" not supported')}e&&e.iceServers&&e.iceServers.forEach(function(e){var n;e.urls&&(-1!==(n="string"==typeof e.urls?e.urls:e.urls[0]).indexOf("transport=udp")&&t.iceServers.push({username:e.username,credential:e.credential,urls:n}))}),this.transceivers=[],this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype._emitBufferedCandidates=function(){var e=this;this._localIceCandidatesBuffer.forEach(function(t){null!==e.onicecandidate&&e.onicecandidate(t)}),this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype.addStream=function(e){this.localStreams.push(e.clone()),this._maybeFireNegotiationNeeded()},window.RTCPeerConnection.prototype.removeStream=function(e){var t=this.localStreams.indexOf(e);t>-1&&(this.localStreams.splice(t,1),this._maybeFireNegotiationNeeded())},window.RTCPeerConnection.prototype._getCommonCapabilities=function(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]};return e.codecs.forEach(function(e){for(var r=0;r<t.codecs.length;r++){var i=t.codecs[r];if(e.name.toLowerCase()===i.name.toLowerCase()&&e.clockRate===i.clockRate&&e.numChannels===i.numChannels){n.codecs.push(i);break}}}),e.headerExtensions.forEach(function(e){for(var r=0;r<t.headerExtensions.length;r++){var i=t.headerExtensions[r];if(e.uri===i.uri){n.headerExtensions.push(i);break}}}),n},window.RTCPeerConnection.prototype._createIceAndDtlsTransports=function(e,t){var n=this,r=new RTCIceGatherer(n.iceOptions),i=new RTCIceTransport(r);r.onlocalcandidate=function(o){var a={};a.candidate={sdpMid:e,sdpMLineIndex:t};var s=o.candidate;s&&0!==Object.keys(s).length?(s.component="RTCP"===i.component?2:1,a.candidate.candidate=v.writeCandidate(s)):(void 0===r.state&&(r.state="completed"),a.candidate.candidate="candidate:1 1 udp 1 0.0.0.0 9 typ endOfCandidates");var c=n.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});null!==n.onicecandidate&&(n.localDescription&&""===n.localDescription.type?(n._localIceCandidatesBuffer.push(a),c&&n._localIceCandidatesBuffer.push({})):(n.onicecandidate(a),c&&n.onicecandidate({})))},i.onicestatechange=function(){n._updateConnectionState()};var o=new RTCDtlsTransport(i);return o.ondtlsstatechange=function(){n._updateConnectionState()},o.onerror=function(){o.state="failed",n._updateConnectionState()},{iceGatherer:r,iceTransport:i,dtlsTransport:o}},window.RTCPeerConnection.prototype._transceive=function(e,t,n){var r=this._getCommonCapabilities(e.localCapabilities,e.remoteCapabilities);t&&e.rtpSender&&(r.encodings=[{ssrc:e.sendSsrc}],r.rtcp={cname:h,ssrc:e.recvSsrc},e.rtpSender.send(r)),n&&e.rtpReceiver&&(r.encodings=[{ssrc:e.recvSsrc}],r.rtcp={cname:e.cname,ssrc:e.sendSsrc},e.rtpReceiver.receive(r))},window.RTCPeerConnection.prototype.setLocalDescription=function(e){var t=this;if("offer"===e.type)this._pendingOffer&&(this.transceivers=this._pendingOffer,delete this._pendingOffer);else if("answer"===e.type){var n=v.splitSections(t.remoteDescription.sdp),r=n.shift();n.forEach(function(e,n){var i=t.transceivers[n],o=i.iceGatherer,a=i.iceTransport,s=i.dtlsTransport,c=i.localCapabilities,d=i.remoteCapabilities;if(!("0"===e.split("\n",1)[0].split(" ",2)[1])){var p=v.getIceParameters(e,r);a.start(o,p,"controlled");var l=v.getDtlsParameters(e,r);s.start(l);var u=t._getCommonCapabilities(c,d);t._transceive(i,u.codecs.length>0,!1)}})}switch(this.localDescription=e,e.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}var i=arguments.length>1&&"function"==typeof arguments[1];if(i){var o=arguments[1];window.setTimeout(function(){o(),t._emitBufferedCandidates()},0)}var a=Promise.resolve();return a.then(function(){i||window.setTimeout(t._emitBufferedCandidates.bind(t),0)}),a},window.RTCPeerConnection.prototype.setRemoteDescription=function(e){var t=this,n=new MediaStream,r=v.splitSections(e.sdp),i=r.shift();switch(r.forEach(function(r,o){var a,s,c,d,p,l,u,f,h,m,g,w=v.splitLines(r)[0].substr(2).split(" "),C=w[0],y="0"===w[1],T=v.getDirection(r,i),b=v.parseRtpParameters(r);y||(m=v.getIceParameters(r,i),g=v.getDtlsParameters(r,i));var R,S=v.matchPrefix(r,"a=mid:")[0].substr(6),P=v.matchPrefix(r,"a=ssrc:").map(function(e){return v.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];if(P&&(f=parseInt(P.ssrc,10),R=P.value),"offer"===e.type){var D=t._createIceAndDtlsTransports(S,o);if(h=RTCRtpReceiver.getCapabilities(C),u=1001*(2*o+2),l=new RTCRtpReceiver(D.dtlsTransport,C),n.addTrack(l.track),t.localStreams.length>0&&t.localStreams[0].getTracks().length>=o){var k=t.localStreams[0].getTracks()[o];p=new RTCRtpSender(k,D.dtlsTransport)}t.transceivers[o]={iceGatherer:D.iceGatherer,iceTransport:D.iceTransport,dtlsTransport:D.dtlsTransport,localCapabilities:h,remoteCapabilities:b,rtpSender:p,rtpReceiver:l,kind:C,mid:S,cname:R,sendSsrc:u,recvSsrc:f},t._transceive(t.transceivers[o],!1,"sendrecv"===T||"sendonly"===T)}else"answer"!==e.type||y||(s=(a=t.transceivers[o]).iceGatherer,c=a.iceTransport,d=a.dtlsTransport,p=a.rtpSender,l=a.rtpReceiver,u=a.sendSsrc,h=a.localCapabilities,t.transceivers[o].recvSsrc=f,t.transceivers[o].remoteCapabilities=b,t.transceivers[o].cname=R,c.start(s,m,"controlling"),d.start(g),t._transceive(a,"sendrecv"===T||"recvonly"===T,"sendrecv"===T||"sendonly"===T),!l||"sendrecv"!==T&&"sendonly"!==T?delete a.rtpReceiver:n.addTrack(l.track))}),this.remoteDescription=e,e.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}return window.setTimeout(function(){null!==t.onaddstream&&n.getTracks().length&&(t.remoteStreams.push(n),window.setTimeout(function(){t.onaddstream({stream:n})},0))},0),arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._updateSignalingState("closed")},window.RTCPeerConnection.prototype._updateSignalingState=function(e){this.signalingState=e,null!==this.onsignalingstatechange&&this.onsignalingstatechange()},window.RTCPeerConnection.prototype._maybeFireNegotiationNeeded=function(){null!==this.onnegotiationneeded&&this.onnegotiationneeded()},window.RTCPeerConnection.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,failed:0};this.transceivers.forEach(function(e){t[e.iceTransport.state]++,t[e.dtlsTransport.state]++}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0||t.checking>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":(t.connecting>0||t.completed>0)&&(e="connected"),e!==this.iceConnectionState&&(this.iceConnectionState=e,null!==this.oniceconnectionstatechange&&this.oniceconnectionstatechange())},window.RTCPeerConnection.prototype.createOffer=function(){var e,t=this;if(this._pendingOffer)throw new Error("createOffer called while there is a pending offer.");1===arguments.length&&"function"!=typeof arguments[0]?e=arguments[0]:3===arguments.length&&(e=arguments[2]);var n=[],r=0,i=0;if(this.localStreams.length&&(r=this.localStreams[0].getAudioTracks().length,i=this.localStreams[0].getVideoTracks().length),e){if(e.mandatory||e.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==e.offerToReceiveAudio&&(r=e.offerToReceiveAudio),void 0!==e.offerToReceiveVideo&&(i=e.offerToReceiveVideo)}for(this.localStreams.length&&this.localStreams[0].getTracks().forEach(function(e){n.push({kind:e.kind,track:e,wantReceive:"audio"===e.kind?r>0:i>0}),"audio"===e.kind?r--:"video"===e.kind&&i--});r>0||i>0;)r>0&&(n.push({kind:"audio",wantReceive:!0}),r--),i>0&&(n.push({kind:"video",wantReceive:!0}),i--);var o=v.writeSessionBoilerplate(),a=[];n.forEach(function(e,n){var r,i,s=e.track,c=e.kind,d=f(),p=t._createIceAndDtlsTransports(d,n),l=RTCRtpSender.getCapabilities(c),u=1001*(2*n+1);s&&(r=new RTCRtpSender(s,p.dtlsTransport)),e.wantReceive&&(i=new RTCRtpReceiver(p.dtlsTransport,c)),a[n]={iceGatherer:p.iceGatherer,iceTransport:p.iceTransport,dtlsTransport:p.dtlsTransport,localCapabilities:l,remoteCapabilities:null,rtpSender:r,rtpReceiver:i,kind:c,mid:d,sendSsrc:u,recvSsrc:null};var h=a[n];o+=v.writeMediaSection(h,h.localCapabilities,"offer",t.localStreams[0])}),this._pendingOffer=a;var s=new C({type:"offer",sdp:o});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,s),Promise.resolve(s)},window.RTCPeerConnection.prototype.createAnswer=function(){var e=this;1===arguments.length&&"function"!=typeof arguments[0]?arguments[0]:3===arguments.length&&arguments[2];var t=v.writeSessionBoilerplate();this.transceivers.forEach(function(n){var r=e._getCommonCapabilities(n.localCapabilities,n.remoteCapabilities);t+=v.writeMediaSection(n,r,"answer",e.localStreams[0])});var n=new C({type:"answer",sdp:t});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,n),Promise.resolve(n)},window.RTCPeerConnection.prototype.addIceCandidate=function(e){var t=e.sdpMLineIndex;if(e.sdpMid)for(var n=0;n<this.transceivers.length;n++)if(this.transceivers[n].mid===e.sdpMid){t=n;break}var r=this.transceivers[t];if(r){var i=Object.keys(e.candidate).length>0?v.parseCandidate(e.candidate):{};if("tcp"===i.protocol&&0===i.port)return;if("1"!==i.component)return;"endOfCandidates"===i.type&&(i={}),r.iceTransport.addRemoteCandidate(i)}return arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.getStats=function(){var e=[];this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(n){t[n]&&e.push(t[n].getStats())})});var t=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1];return new Promise(function(n){var r={};Promise.all(e).then(function(e){e.forEach(function(e){Object.keys(e).forEach(function(t){r[t]=e[t]})}),t&&window.setTimeout(t,0,r),n(r)})})}}}else d.log("Browser does not appear to be WebRTC-capable");else d.log("This does not appear to be a browser"),a="not a browser";function m(e){return new Promise(function(t,n){r(e,t,n)})}"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){var t=this;this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){"chrome"===a&&e.stream.addEventListener("addtrack",function(n){var r=new Event("track");r.track=n.track,r.receiver={track:n.track},r.streams=[e.stream],t.dispatchEvent(r)}),e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t,n.receiver={track:t},n.streams=[e.stream],this.dispatchEvent(n)}.bind(this))}.bind(this))}});var g,w,C,y={};try{Object.defineProperty(y,"version",{set:function(e){s=e}})}catch(e){}"undefined"!=typeof window&&(g=window.RTCPeerConnection,w=window.RTCIceCandidate,C=window.RTCSessionDescription),e.exports={RTCPeerConnection:g,RTCIceCandidate:w,RTCSessionDescription:C,getUserMedia:r,attachMediaStream:i,reattachMediaStream:o,webrtcDetectedBrowser:a,webrtcDetectedVersion:s,webrtcMinimumVersion:c,webrtcTesting:y,webrtcUtils:d}},3:function(e,t,n){"use strict";t.a=class{constructor(){this.__eventListeners={}}addEventListener(e,t){null!=t&&(this.__eventListeners[e]?this.__eventListeners[e].push(t):this.__eventListeners[e]=[t])}trigger(e,t){let n=this.__eventListeners[e];n&&n.forEach(n=>{try{n(t)}catch(r){console.warn("calling listener "+n.name+" for event type "+e+" with parameters '"+t+"' resulted in an error!",r)}})}}}}))}}});