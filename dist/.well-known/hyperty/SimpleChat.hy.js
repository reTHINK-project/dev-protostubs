System.register([],function(e){return{execute:function(){e(function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=43)}({43:function(e,t,r){"use strict";r.r(t);t.default=class{constructor(){}set name(e){this._name=e}get name(){return this._name}get runtimeHypertyURL(){return this._myUrl}_start(e,t,r,n){let o=this;o._factory=n,o._syncher=n.createSyncher(e,t,r),o._manager=n.createSimpleChatManager(e,t,r,o._syncher),o.discovery=o._manager.discovery,o.identityManager=o._manager.identityManager,o._domain=o._manager._domain,o._myUrl=e,o.hypertyURL=e,o._runtimeURL=r.runtimeURL,o._bus=t,o._syncher.onNotification(function(e){console.log("[SimpleChat] onNotification: ",e),o.processNotification(e)}),console.log("[SimpleChat] configuration ",r),o._manager.offline=!!r.offline&&r.offline,o._manager.backup=!!r.backup&&r.backup}resume(){console.log("[SimpleChat.resume] "),this._resumeReporters(),this._resumeObservers()}register(e,t){let r=this;r._manager.identityManager.discoverUserRegistered().then(n=>{const o={userProfile:{guid:n.guid,userURL:n.userURL,info:{code:t}}};let s={type:"forward",to:e,from:r.hypertyURL,identity:o,body:{type:"create",from:r.hypertyURL,identity:o}};r._bus.postMessage(s)}).catch(e=>{console.error("[SimpleChat] ERROR:",e),reject(e)})}newParticipant(e,t,r){let n=this;n._manager.identityManager.discoverUserRegistered().then(o=>{console.log("[SimpleChat] GET MY IDENTITY :",o);let s={type:"forward",to:`${e}/tickets`,from:r,identity:o,body:{type:"update",from:r,identity:o,status:"new-participant",participant:t}};n._bus.postMessage(s)}).catch(e=>{console.error("[SimpleChat] ERROR:",e),reject(e)})}closeTicket(e,t,r){let n=this;n._manager.identityManager.discoverUserRegistered().then(o=>{let s={type:"forward",to:`${e}/tickets`,from:r,identity:o,body:{type:"update",from:r,identity:o,status:"closed",participant:t}};n._bus.postMessage(s)}).catch(e=>{console.error("[SimpleChat] ERROR:",e),reject(e)})}_getRegisteredUser(){let e=this;return new Promise((t,r)=>{e._manager.currentIdentity?t(e._manager.currentIdentity):e._manager.identityManager.discoverUserRegistered().then(e=>{console.log("[SimpleChat] GET MY IDENTITY:",e),t(e)}).catch(e=>{console.error("[SimpleChat] ERROR:",e),r(e)})})}_resumeReporters(){let e=this;e._syncher.resumeReporters({store:!0}).then(t=>{let r=Object.keys(t);r.length>0&&e._getRegisteredUser().then(n=>{let o,s=[];r.forEach(r=>{console.log("[SimpleChat.resumeReporter]: ",r),o=t[r].sync().then(()=>{console.log("[SimpleChat.resumeReporter] updated Chat ",t[r]);let o=e._factory.createChat(e._syncher,e._domain,n,e._manager);o.dataObjectReporter=t[r],this._manager._reportersControllers[r]=o,e._resumeInterworking(o.dataObjectReporter)}),s.push(o)}),Promise.all(s).then(()=>{e._onResumeReporter&&e._onResumeReporter(this._manager._reportersControllers)})})}).catch(e=>{console.info("[SimpleChat.resumeReporters] :",e)})}_resumeObservers(){let e=this;e._syncher.resumeObservers({store:!0}).then(t=>{console.log("[SimpleChat] resuming observers : ",t,e,e._onResume);let r=Object.keys(t);r.length>0&&e._getRegisteredUser().then(n=>{let o,s=[];r.forEach(r=>{console.log("[SimpleChat].syncher.resumeObserver: ",r),o=t[r].sync().then(()=>{let o=t[r],s=e._factory.createChat(e._syncher,e._domain,n,e._manager);s.dataObjectObserver=o,this._manager._observersControllers[r]=s}),s.push(o)}),Promise.all(s).then(()=>{e._onResumeObserver&&e._onResumeObserver(this._manager._observersControllers)})})}).catch(e=>{console.info("[SimpleChat] Resume Observer | ",e)})}_resumeInterworking(e){let t=this;if(e.data.participants){let r=e.data.participants,n=e.url,o=e.schema;console.log("[SimpleChat._resumeInterworking for] ",r),Object.keys(r).forEach(s=>{let i=r[s].identity.userProfile.userURL.split("://");if("user"!==i[0]){console.log("[SimpleChat._resumeInterworking for] ",s),i=i[0]+"://"+i[1].split("/")[1];let r={type:"create",from:t._myUrl,to:i,body:{resource:n,schema:o,value:e.metadata}};t._bus.postMessage(r,()=>{})}})}}create(e,t,r={mutual:!1,domain_registration:!1,reuseURL:!0}){return this._manager.create(e,t,r)}onInvitation(e){return this._manager.onInvitation(e)}onResumeReporter(e){this._onResumeReporter=e}onResumeObserver(e){this._onResumeObserver=e}join(e){return this._manager.join(e,!1)}myIdentity(e){return console.log("[SimpleChat.myIdentity] ",e),this._manager.myIdentity(e)}processNotification(e){return this._manager.processNotification(e)}onInvitation(e){return this._manager.onInvitation(e)}}}}))}}});